import java.util.*;
import java.time.LocalDate;  
import java.math.BigDecimal;  

enum stage{PROSPECTING,QUALIFICATION,NEEDANALYSIS,NEGOTIATIONREVIEW,CLOSEDWON,CLOSEDLOST;}
public class Main {

  public static void main(String[] args) {
   Account google=new Account("Google");
   Account alpha=new Account("Alphabet");
   Account youtube=new Account("Youtube");

   Contact googleContact=new Contact("Sameeksha","Agarwal");
   Contact alphaContact=new Contact("Dimpy","Boddapati");
   Contact youtubeContact=new Contact("Swetha","Reddy");
   Contact youtubeContact1=new Contact("Dimple","Khanna");
   Contact youtubeContact2=new Contact("Bhavna","T");
   youtubeContact2.addAccount(youtube);
   Opportunity googleOpp=new Opportunity("Google opp 0",LocalDate.of(2022,1,12),stage.PROSPECTING);
   Opportunity googleOpp1=new Opportunity("Google Opp 1",LocalDate.of(2022,1,10),stage.PROSPECTING);
   Opportunity alphaOpp=new Opportunity("Alphabet opp",LocalDate.of(2022,2,1),stage.NEEDANALYSIS);
   Opportunity youtubeOpp=new Opportunity("Youtube opp 0",LocalDate.of(2022,1,1),stage.PROSPECTING);
   Opportunity youtubeOpp1=new Opportunity("Youtube opp 1",LocalDate.of(2021,12,10),stage.NEEDANALYSIS);
   
   System.out.println("All accounts");
   System.out.println(Account.allAccountsList);
   System.out.println("-----------------------");

   System.out.println("All contacts");
   System.out.println(Contact.allContactsList);
   System.out.println("-----------------------");
    
   System.out.println("All opportunities");
   System.out.println(Opportunity.allOpportunitiesList);
   System.out.println("-----------------------");

  System.out.println("Searching all accounts by account name");
  System.out.println(Account.filterByName("tube"));
  System.out.println("Searching all contacts by contact name");
  System.out.println(Contact.filterByName("mp"));
  System.out.println("Searching all opportunities by opportunity name");
  System.out.println(Opportunity.filterByName("Google"));
  System.out.println("-----------------------");

  System.out.println("Linking contacts to accounts: can be done in 2 ways");
  youtubeContact.addAccount(youtube);// add Swetha Reddy as contact
  youtube.addContact(youtubeContact1);// add Dimple Khanna as contact
  System.out.println("Related contacts in Youtube \n"+ youtube.relatedContacts);
  System.out.println("-----------------------");

  System.out.println("Linking opportunity to account:can be done in 2 ways");
  youtube.addOpportunity(youtubeOpp);
  youtubeOpp1.addAccount(youtube);
  System.out.println("Related Opportunities in Youtube \n"+youtube.relatedOpportunities);
  System.out.println("-----------------------");


  System.out.println("Account.annualRevenue updation whenever amount in opp is updated or added");
  google.addOpportunity(googleOpp);
  google.addOpportunity(googleOpp1);
  googleOpp1.addAmount(new BigDecimal("200000"));
   System.out.println("1st opp linked with amount 200000 :"+google.getRevenue());
  googleOpp.addAmount(new BigDecimal("100000"));
  System.out.println("2nd opp linked with amount 100000 :"+google.getRevenue());
  googleOpp.addAmount(new BigDecimal("150000"));//addAmount can be used to edit or update, this amount overwrites previously entered amount
  System.out.println("after updating 2nd opp amount to 150000 :"+google.getRevenue());
  System.out.println("-----------------------");


  System.out.println("Sort by revenue(ascending)");
  alphaOpp.addAmount(new BigDecimal("10000"));
  alpha.addOpportunity(alphaOpp);
  Collections.sort(Account.allAccountsList);
  for(Account a:Account.allAccountsList)
  {
   System.out.println(a.accountId + " "+ a.getRevenue());
  }
  System.out.println("-----------------------");

  System.out.println("List all accounts with revenue > 10000");
  Account.filterByRevenue(new BigDecimal("10000"));
  System.out.println("-----------------------");
 

 System.out.println("Account wise list of all opportunities at Prospecting stage");
 Opportunity unlinkedOpp=new Opportunity("Opp 0",LocalDate.of(2021,12,10),stage.PROSPECTING);
 Opportunity.accountWiseOppStageFilter(stage.PROSPECTING);
 System.out.println("-----------------------");


 System.out.println("Tracking all contacts,opportunities,accounts");
 System.out.println("All contact:\n"+Contact.allContactsList);
 System.out.println("All Opps:\n"+Opportunity.allOpportunitiesList);
 System.out.println("All accounts:\n"+Account.allAccountsList);
 System.out.println("-----------------------");
 

 


 System.out.println("Map<Integer, List<Opportunity>");//map between Account ID, list of opportunities
 Map<Integer,List<Opportunity>> accountToOppMap=new HashMap<>();
  for(Account acc:Account.allAccountsList)
  {
    accountToOppMap.put(acc.accountId,acc.relatedOpportunities);
  }
 System.out.println(accountToOppMap);
 System.out.println("-----------------------");


 System.out.println("Map<Integer,List<Contact>");
 alpha.addContact(new Contact("Manogna","Belagal"));//add this to Account ID 2
 Map<Integer,List<Contact>> accountToContMap=new HashMap<>();
  for(Account acc:Account.allAccountsList)
  {
    accountToContMap.put(acc.accountId,acc.relatedContacts);
  }
  System.out.println(accountToContMap);
  System.out.println("-----------------------");


 System.out.println("Contact reach path");// reportsTo() uses findContactReach() to find out if the contact is reporting to one below it's hierarchy
 System.out.println(youtube.relatedContacts);
 youtubeContact2.reportsTo(youtubeContact1);//Bhavna(5) reports to Dimple(4)
 youtubeContact1.reportsTo(youtubeContact);//Dimple(4) reports to Swetha(3)
 youtubeContact2.findContactReachTo(youtubeContact);
 youtubeContact.reportsTo(youtubeContact1);// doesn't set reportsTo as Dimple is below Swetha in heirarchy
 System.out.println("3 Reports to: "+youtubeContact.reportsTo);
 youtubeContact.reportsTo(youtubeContact);
 System.out.println("3 Reports to:"+ youtubeContact.reportsTo);
 System.out.println("-----------------------");
 System.out.println("-----------------------");

 System.out.println("Map -> Contact Id : ReportsTo Contact Id");
 Map<Integer,Integer> contactToReportstoMap=new HashMap<>();
 for(Contact c:Contact.allContactsList)
  {
   contactToReportstoMap.put(c.contactId,c.reportsTo==null?null:c.reportsTo.contactId);
    
  }
  System.out.println(contactToReportstoMap);
  System.out.println("-----------------------");

 /* Collections.sort(Account.allAccountsList);
  for(Account a:Account.allAccountsList)
  {
     System.out.println(a +",annual revenue "+ a.annualRevenue);
  }
  */
  
 
  }
}


class Contact
{
  static int contactsCount=0;
  static List<Contact> allContactsList=new ArrayList<>();
  int contactId;
  String salutation,firstName,lastName,email,title,phone;
  Account accountName;
  Contact reportsTo;
  List<Contact> reporters=new ArrayList<>();
  public Contact(String fName,String lName)
  {
   this.firstName=fName;
   this.lastName=lName;
   contactId=(++contactsCount);
   allContactsList.add(this);// maintains list of all contacts
  }
  public void reportsTo(Contact reportee)//adds reportee and also adds this contact under reportee's reporter list
  {   if(reportee.findContactReachTo(this)==false && reportee!=this)
     {
      this.reportsTo=reportee;
      reportee.reporters.add(this);// adds this to reportee's reporters list
     }
     else{
       System.out.println("Contact you are reporting to is below or equal in hierarchy");
     }
  }
  public boolean findContactReachTo(Contact a){
    boolean contactReached=false;
    Contact dest=null,currentContact;
    currentContact=this;
    while(currentContact.reportsTo!=null)// iterates till reports to is null or till destination contact is found
    {
     if(currentContact.reportsTo==a)
     {
      contactReached=true;
      dest=currentContact.reportsTo;
      break;
     }
     currentContact=currentContact.reportsTo;
    }
    currentContact=this;
    if(contactReached==true)
    { 
      while(!currentContact.equals(dest))
      {
         System.out.print(currentContact.contactId+"-->");
         currentContact=currentContact.reportsTo;
      }
      System.out.print(currentContact.contactId+"\n");
    }
    else{
      System.out.println("No contact reach found");
    }
    return contactReached;
  }
  public static List<Contact> filterByName(String searchThis)
  {
     List<Contact> searchResults=new ArrayList<>();
     for(Contact contact:allContactsList)
     {
        if(contact.firstName.contains(searchThis) || contact.lastName.contains(searchThis))
        {
        searchResults.add(contact);
        }
      }
     return searchResults;
  }
  public String toString(){
    return (this.contactId + " : " +this.firstName +" " + this.lastName);
  }
  public void addAccount(Account a)//links this contact to Account's contact list
  {
   this.accountName=a ;
   int index=this.accountName.relatedContacts.indexOf(this);
   
    if(index!= -1)
    {
    this.accountName.relatedContacts.set(index,this);//updates account's contact list 
    }
    else{
      this.accountName.relatedContacts.add(this);//if account's contact list don't have this contact,this one is added
    }
  }
}
class Opportunity implements Comparable<Opportunity>
{
  static int oppCount=0;
  static List<Opportunity> allOpportunitiesList=new ArrayList<>();
  int oppId;
  String oppName;
  Account accountName;
  LocalDate closeDate;
  BigDecimal amount=new BigDecimal("0");
  stage oppStage;
  static List<Opportunity> oppsFilteredByStage=new ArrayList<>();
  
  Opportunity(String oppName,LocalDate closeDate,stage oppStage)
  {
  this.oppName=oppName;
  this.closeDate=closeDate;
  this.oppStage=oppStage;
  oppId=(++oppCount);
  Account accountName=null;
  allOpportunitiesList.add(this);
  }
  public void addAmount(BigDecimal amount)
  {//used to add opport. amount to opportunity and to update account revenue if account is set
     this.amount=amount;
     if(this.accountName!=null)
     {
     int index=this.accountName.relatedOpportunities.indexOf(this);
     this.accountName.relatedOpportunities.set(index,this);
     this.accountName.updateRevenue();
    }
  }
  public void addAccount(Account a) //adds/updates this opportunity in Account's oppor. list & updates revenue
  {
    this.accountName=a;
    int index=this.accountName.relatedOpportunities.indexOf(this);
   
    if(index!= -1)
    {
    this.accountName.relatedOpportunities.set(index,this);//updates account's opportunity list 
    }
    else{
      this.accountName.relatedOpportunities.add(this);//if account's oppor. list don't have this opportunity,this one is added
    }
    this.accountName.updateRevenue();//for updating account's revenue whenever this method is called
  }
  public static List<Opportunity> filterByName(String searchThis)
  {
     List<Opportunity> searchResults=new ArrayList<>();
     for(Opportunity opportunity:allOpportunitiesList)
     {
        if(opportunity.oppName.contains(searchThis))
        {
        searchResults.add(opportunity);
        }
      }
     return searchResults;
  }
  public String toString(){
    return(this.oppId +" : "+ this.oppName );
  }
  private static void filterByStage(stage opportunityStage)
  {
    //Integer accId;
    for(Opportunity o:allOpportunitiesList)
    {
      if(o.oppStage ==opportunityStage)
      {
       oppsFilteredByStage.add(o);
       /*accId= (o.accountName==null)?null: o.accountName.accountId;
       System.out.println("Account Id ="+ accId+"Opportunity "+o);*/
      }
    }
   // return oppsFilteredByStage;
  }
 public int compareTo(Opportunity o)
 {
  if(this.accountName!=null && o.accountName != null)// how to compare if accountName is linked
  {
    if(this.accountName.accountId==o.accountName.accountId)
    {
      return 0;
    }
    else if(this.accountName.accountId>o.accountName.accountId)
    {
     return 1;
    }
    else
    {
      return -1;
    }
  }
  else if(this.accountName==null && o.accountName!=null)// logic to compare first opportunity =null and next one !=null
  {
    return 1;
  }
  else{
    return -1;// Logic to compare 1st opportunity !=null and 2nd one =null
  }
  
 }

 public static List<Opportunity> accountWiseOppStageFilter(stage s)
 { oppsFilteredByStage.clear();
   System.out.println("Account Id\tOpportunity");
   filterByStage(s);
   List<Opportunity> x=oppsFilteredByStage;
   Collections.sort(x);
   for(Opportunity i:x)
   {
     if(i.accountName!=null)
     {
     System.out.println(i.accountName.accountId+"\t\t\t"+ i);
     }
     else
     {
     System.out.println("\t\t\t"+i);
     }
   }
   return x;
 }
}
class Account implements Comparable<Account>
{
 static int accountsCount=0;
 int accountId;
 static List<Account> allAccountsList=new ArrayList<>();
 String accountName,website;
 Account parentAccount;
 private List<Account> childrenAccounts=new ArrayList<>();
 BigDecimal annualRevenue=new BigDecimal("0");
 List<Opportunity> relatedOpportunities=new ArrayList<>();
 List<Contact> relatedContacts=new ArrayList<>();
 Account(String accountName)
 {
   this.accountName=accountName;
   accountId=(++accountsCount);
   allAccountsList.add(this);
 }

public List<Account> getChildrenAccounts(){
  return childrenAccounts;
}
 public void addParentAccount(Account parent)// adds parent account and adds this account in parent's childrenAccounts list
 {
   parentAccount=parent;
   parent.childrenAccounts.add(this);
 }
 //create a method to add revenue whenever 
 //add a line to reduce count when remove() is called
 public static List<Account> filterByName(String searchThis)
  {
     List<Account> searchResults=new ArrayList<>();
     for(Account account:allAccountsList)
     {
        if(account.accountName.contains(searchThis))
        {
        searchResults.add(account);
        }
      }
     return searchResults;
  }
 public String toString(){
    return(this.accountId +" : "+ this.accountName );
  }
  public void addOpportunity(Opportunity opportunity){//links opportunity to account and updating Account revenue thereafter
    opportunity.accountName=this;
    this.relatedOpportunities.add(opportunity);
    annualRevenue= annualRevenue.add(opportunity.amount);

    
  }
  public void updateRevenue(){ 
      //used by Opportunity methods addAccount or addAmount is called
     annualRevenue=new BigDecimal("0");
     for(Opportunity o:relatedOpportunities)
     {
       annualRevenue=annualRevenue.add(o.amount);
     }
    
  }
  public void addContact(Contact contact)// links contact to this account
  {
     contact.accountName=this;
     this.relatedContacts.add(contact);
     
  }
    
  public BigDecimal getRevenue(){
    return this.annualRevenue;
  }
  public static void filterByRevenue(BigDecimal revenue)
  {
    for(Account a:allAccountsList)
    {
     if(a.annualRevenue.compareTo(revenue) ==1 )
     {
      System.out.println(a+" "); 
     }
    }
  }
   public int compareTo(Account acc)
   {
     int com=this.annualRevenue.compareTo(acc.annualRevenue);
     return com;
   }
  
}
